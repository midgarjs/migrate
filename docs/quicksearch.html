<html>
<head>
</head>
<body style="background: transparent;">
    <script src="scripts/docstrap.lib.js"></script>
    <script src="scripts/lunr.min.js"></script>
    <script src="scripts/fulltext-search.js"></script>

    <script type="text/x-docstrap-searchdb">
    {"global.html":{"id":"global.html","title":"Global","body":" Documentation Classes MigratePluginMigrateService Events event:@midgar/migrate:afterExecevent:@midgar/migrate:beforeExecevent:@midgar/migrate:init Global serviceName} Global Members &lt;constant&gt; serviceName :string Service name Type: string } :Midgar Plugin config Type: Midgar Type Definitions ExecutedMigration Type: Object Properties: Name Type Description plugin sring Plugin name type sring Migration type (schema|data) path sring Migration file path time number exec time in ms Migration Type: Object Properties: Name Type Description plugin string Plugin name name string Migration file name type string Migration type (schema|data) MigrationModule Type: Object Properties: Name Type Description up function Up function down function Down function Events @midgar/migrate:afterExec afterExec event. @midgar/migrate:beforeExec beforeExec event. @midgar/migrate:init init event. × Search results Close Documentation generated by JSDoc 3.6.3 on 2020-01-20T00:17:48+00:00 using the DocStrap template. "},"classes.list.html":{"id":"classes.list.html","title":"Classes","body":" Documentation Classes MigratePluginMigrateService Events event:@midgar/migrate:afterExecevent:@midgar/migrate:beforeExecevent:@midgar/migrate:init Global serviceName} Classes Classes MigratePlugin MigrateService Events @midgar/migrate:afterExec afterExec event. @midgar/migrate:beforeExec beforeExec event. @midgar/migrate:init init event. × Search results Close Documentation generated by JSDoc 3.6.3 on 2020-01-20T00:17:48+00:00 using the DocStrap template. "},"index.html":{"id":"index.html","title":"Index","body":" Documentation Classes MigratePluginMigrateService Events event:@midgar/migrate:afterExecevent:@midgar/migrate:beforeExecevent:@midgar/migrate:init Global serviceName} @midgar/migrate Système de migration pour Midgar Installation $ npm i @midgar/migrate Si tout s'est bien passé, un message de confirmation s'affiche: #midgar-cli @midgar/migrate added to plugins.json ! Fonctionnement Ajoute les types de modules midgar-migrate-schema dans le dossier ./migrations/schemas et midgar-migrate-data,./migrations/data. Les migration data sont exéctuté apres les schema. Ce plugin à besoin d'un storage pour fonctionner. Le storage sert a sauvegarder de facon permanante l'état des migrations. module migration Exemple de module de migration: export default { up: async (mid, ...storageArgs) =&gt; { // Up script }, down: async (mid, ...storageArgs) =&gt; { // Down script } } Commandes cli Up Exéctute up sur toutes les migrations en attente: $ midgar migrate:up Exéctute up sur les 3 premières migrations en attente: $ midgar migrate:up 3 Down Exéctute down sur toutes les migrations en executé: $ midgar migrate:down Exéctute down sur les 3 denière migrations en executé: $ midgar migrate:down 3 Status Affiche le nombre et la liste de migration en attente d'exécutions: $ midgar migrate:down Paramètre optionnels --config chemin vers le dossier de configuration du projet: $ midgar migrate:up --config ~/mon-project/src/config --storage clef du storage: $ midgar migrate:up --storage mongo Storages Exemple de storage: /** * @typedef {Object} Migration * @property {string} plugin Plugin name * @property {string} name Migration file name * @property {string} type Migration type (schema|data) */ class Storage { constructor (mid) { this.mid = mid } /** * @return {&lt;Promis&lt;boolean&gt;&gt;} */ async isInstalled () { return true } /** * @return {&lt;Promis&lt;Array&lt;Mirgration&gt;&gt;&gt;} */ async getMigrations () { return [] } /** * Save executed migration * * @param {string} plugin Plugin name * @param {string} name Migration file name * @param {string} type Migration type (schema|data) * * @return {Promise&lt;void&gt;} */ async saveMigration (plugin, name, type) {} /** * Delete executed migration * * @param {string} plugin Plugin name * @param {string} name Migration file name * @param {string} type Migration type (schema|data) * * @return {Promise&lt;void&gt;} */ async deleteMigration (plugin, name, type) {} /** * Retrun migation function args after midgar instance * * @return {Array&lt;any&gt;} */ getCallArgs () { return [] } } export default Storage Ajouter le storate Depuis la méthode init du plugin: import Storage from './libs/migrate-storage.js' ... this.mid.on('@midgar/migrate:init', (migrateService) =&gt; { migrateService.addStorage('monstorage', Storage) }) documentation Api. × Search results Close Documentation generated by JSDoc 3.6.3 on 2020-01-20T00:17:48+00:00 using the DocStrap template. "},"MigratePlugin.html":{"id":"MigratePlugin.html","title":"Class: MigratePlugin","body":" Documentation Classes MigratePluginMigrateService Events event:@midgar/migrate:afterExecevent:@midgar/migrate:beforeExecevent:@midgar/migrate:init Global serviceName} Class: MigratePlugin MigratePlugin MigratePlugin class new MigratePlugin() Members dataModuleTypeKey :string Data module type key Type: string schemaModuleTypeKey :string Schema module type key Type: string Methods init() Init plugin Add schama et data module types × Search results Close Documentation generated by JSDoc 3.6.3 on 2020-01-20T00:17:48+00:00 using the DocStrap template. "},"MigrateService.html":{"id":"MigrateService.html","title":"Class: MigrateService","body":" Documentation Classes MigratePluginMigrateService Events event:@midgar/migrate:afterExecevent:@midgar/migrate:beforeExecevent:@midgar/migrate:init Global serviceName} Class: MigrateService MigrateService MidgarService class new MigrateService(mid) Constructor Parameters: Name Type Description mid Midgar Midgar instance Members config :object Plugin config Type: object plugin :MigratePlugin Migrate plugin instance Type: MigratePlugin storages :object Storages Type: object Methods _getMigrationModuleFile(migration, migrationFiles, type) Return migration module file corresponding to migration Object Parameters: Name Type Description migration Migration Migration object migrationFiles Array.&lt;ModuleFile&gt; Array of migration module files type string Migration type (schema|data) Returns: Type ModuleFile @private _isExecuted(name, plugin, type, executedMigrations) Return true if the migration already executed or false Parameters: Name Type Description name string Migration filename plugin string Plugin name type string Migration type (schema | data) executedMigrations Array.&lt;Migration&gt; Executed migrations Returns: Type boolean private addStorage(key, storage) Add storage Parameters: Name Type Description key string Storage key storage MigrateStorage Storage instance &lt;async&gt; down() Downgrade num executed migrations Returns: } Type Promise.&lt;Array.&lt;ExecutedMigration&gt;&gt; &lt;async&gt; getPendingMigrations(storageKey, import_) Return pending migrations Parameters: Name Type Description storageKey string Storage key import_ boolean Flag to import or not modules Returns: Type Promise.&lt;Array.&lt;ModuleFile&gt;&gt; getStorage(key) Return storage instance by key Parameters: Name Type Default Description key string null Storage key Returns: Type MigrateStroage &lt;async&gt; init() Init service Let other plugin add storage Returns: Type Promise.&lt;void&gt; &lt;async&gt; up(num, storageKey) Execute num pending migrations Parameters: Name Type Default Description num int null Number of version to execute storageKey string null Storage key Returns: Type Promise.&lt;Array.&lt;ExecutedMigration&gt;&gt; × Search results Close Documentation generated by JSDoc 3.6.3 on 2020-01-20T00:17:48+00:00 using the DocStrap template. "}}
    </script>

    <script type="text/javascript">
        $(document).ready(function() {
            Searcher.init();
        });

        $(window).on("message", function(msg) {
            var msgData = msg.originalEvent.data;

            if (msgData.msgid != "docstrap.quicksearch.start") {
                return;
            }

            var results = Searcher.search(msgData.searchTerms);

            window.parent.postMessage({"results": results, "msgid": "docstrap.quicksearch.done"}, "*");
        });
    </script>
</body>
</html>
